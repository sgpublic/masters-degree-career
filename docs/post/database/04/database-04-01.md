---
sidebar_position: 0
---

# 4.1 关系代数

## 4.1.1 集合运算符

集合运算符包括：

| 运算符      | 含义   | SQL                          | 用途            |
|----------|------|------------------------------|---------------|
| $\cup$   | 并    | `UNION`（去重）、`UNION ALL`（不去重） | 两个集合的并集       |
| $-$      | 差    | `EXCEPT`                     | 前者去掉后者的元素     |
| $\cap$   | 交    | `INTERSECT`                  | 两个集合共有的元素     |
| $\times$ | 笛卡尔集 | `CROSS JOIN`                 | 两个集合的所有元素排列组合 |

## 4.1.2 专门的关系运算

| 运算符       | 含义 | 关系代数语法                                                          | 用途                     |
|-----------|----|-----------------------------------------------------------------|------------------------|
| $\sigma$  | 选择 | $\sigma_{\text{条件1,条件2...}}(R)$                                 | 按条件筛选记录                |
| $\pi$     | 投影 | $\pi_{\text{列1,列2...}}(R)$                                      | 选择某列                   |
| $\bowtie$ | 连接 | $R \bowtie S$（自然连接）<br/>$R \bowtie_{\text{条件1,条件2...}} S$（等值连接） | 关联两个关系                 |
| $\div$    | 除  | $R \div S$                                                      | 找出所有与另一关系的每一行都有对应关系的元组 |

### 4.1.2.1 连接

连接分**自然连接**和**等值连接**。

设两个关系：

```
R(rid, x, y)
S(sid, x, z)
```

+ **等值连接**：保留同名列，并在结果中用表名作前缀区分

 $$
 R \bowtie S=RS(rid, sid, R.x, S.x, y, z)
 $$
+ **自然连接**：按指定条件匹配，相同列只保留一次

  $$
  R \bowtie_{\text{R.x=S.x}} S=RS(rid, sid, x, y, z)
  $$

### 4.1.2.2 除

计算步骤如下：

+ 找出 R 和 S 相同的列（假设是 C 列）；
+ R 中去掉 C 列的其余列，按剩余列分组；
+ 对每一组，检查 C 列的值集合是否 包含 S 的所有值且数量相等；
+ 满足条件的组，把剩余列加入结果。

具体的，设两个关系：

+ R(name, pid)

  | name | pid |
  |------|-----|
  | 张三   | P1  |
  | 张三   | P2  |
  | 李四   | P2  |
+ S(pid, platform)

  | pid | platform |
  |-----|----------|
  | P1  | A1       |
  | P2  | A1       |

计算 $R \div S$：

1. 两个关系中相同名称的列有 `pid`。
2. 将 $R$ 中 `pid` 列去掉后去重，得到关系 $Rp$：

   | name |
   |------|
   | 张三   |
   | 李四   |
3. 将 $S$ 仅保留 `pid` 列去掉后去重，得到关系 $Sp$：

   | pid |
   |-----|
   | P1  |
   | P2  |
4. 将 $R$ 按照上述结果分组，并去除列 `pid`，得到两组结果：

   + `name=张三`

     | pid |
     |-----|
     | P1  |
     | P2  |
   
     此结果与 $Sp$ 相同，则此行加入结果。
   
   + `name=李四`

     | pid |
     |-----|
     | P2  |

     此结果与 $Sp$ 不同，跳过。
5. 综上，计算结果为：

   | name |
   |------|
   | 张三   |